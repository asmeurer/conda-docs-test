

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using shared libraries &mdash; Conda   documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Conda   documentation" href="../index.html"/>
        <link rel="up" title="Building packages" href="build.html"/>
        <link rel="next" title="Custom channels" href="../custom-channels.html"/>
        <link rel="prev" title="Conda package specification" href="../spec.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Conda
          

          
          </a>

          
            
            
              <div class="version">
                 
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/index.html">Using conda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="build.html">Building packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../build_tutorials.html">Build tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="bpp.html">Building conda packages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using shared libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shared-libraries-in-linux-and-os-x">Shared libraries in Linux and OS X</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shared-libraries-in-windows">Shared libraries in Windows</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../custom-channels.html">Custom channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../signed-packages.html">Signing conda packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bdist_conda.html">Bdist_conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample-recipes.html">Sample recipes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help/help.html">Help &amp; reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-involved.html">Get involved</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Conda</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="build.html">Building packages</a> &raquo;</li>
      
    <li>Using shared libraries</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/conda/conda-docs/blob/master/docs/source/building/shared-libraries.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-shared-libraries">
<h1>Using shared libraries<a class="headerlink" href="#using-shared-libraries" title="Permalink to this headline">¶</a></h1>
<p><strong>Shared libraries</strong> are libraries that are loosely coupled to the programs and extensions that depend on them. When loading an executable into memory, an operating system will find all dependent shared libraries and link them to the executable so that it can run.</p>
<p>The major operating systems Linux, OS X, and Windows all provide a way to build executables and libraries that contain links to the shared libraries they depend on, instead of directly linking the libraries themselves. We&#8217;ll discuss Linux and OS X first, then Windows because it is quite a bit different.</p>
<div class="section" id="shared-libraries-in-linux-and-os-x">
<h2>Shared libraries in Linux and OS X<a class="headerlink" href="#shared-libraries-in-linux-and-os-x" title="Permalink to this headline">¶</a></h2>
<p>In Linux and OS X, dynamic links are discovered in a similar manner to the way that Python modules are discovered via <code class="docutils literal"><span class="pre">PYTHONPATH</span></code>, and executables are discovered via <code class="docutils literal"><span class="pre">PATH</span></code>.  A list of search locations is made, then the library objects are searched for in the search locations.  By default, as well as by design, the system dynamic linker does not have any special preference for the conda environment <code class="docutils literal"><span class="pre">lib</span></code> directories.</p>
<p>Both absolute links and relative links may be specified. If the links were absolute paths like <code class="docutils literal"><span class="pre">/Users/jsmith/my_build_env</span></code> then the library would only work on a system where that exact path exists. Therefore, relative links are preferred in conda packages.</p>
<p>To use relative links, we need to use a special variable in the link itself.  In Linux, the $ORIGIN variable allows you to say &#8220;relative to this file as it&#8217;s being executed&#8221;.  On OS X, there are <code class="docutils literal"><span class="pre">&#64;rpath</span></code>, <code class="docutils literal"><span class="pre">&#64;loader_path</span></code>, <code class="docutils literal"><span class="pre">&#64;executable_path</span></code>.  <code class="docutils literal"><span class="pre">&#64;rpath</span></code> allows you to set relative links from the system load paths, while <code class="docutils literal"><span class="pre">&#64;loader_path</span></code> is equivalent to <code class="docutils literal"><span class="pre">$ORIGIN</span></code>, and <code class="docutils literal"><span class="pre">&#64;executable_path</span></code> supports the Apple &#8221;.app&#8221; directory approach, where libraries know where they live relative to their calling application.</p>
<p>Conda build uses <code class="docutils literal"><span class="pre">$ORIGIN</span></code> on Linux and <code class="docutils literal"><span class="pre">&#64;loader_path</span></code> on Mac OS X since we install into a common root directory and can assume that other libraries will also be installed into that root.  The use of the variables allows us to build <em>relocatable binaries</em> that can be built on one person&#8217;s system and sent everywhere.</p>
<p>On Linux, <code class="docutils literal"><span class="pre">conda-build</span></code> modifies any shared libraries or generated executables to use a relative dynamic link by calling the <code class="docutils literal"><span class="pre">patchelf</span></code> tool. On Mac OS X, the <code class="docutils literal"><span class="pre">install_name_tool</span></code> tool is used.</p>
<p>CAUTION: setting <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code> (on Linux) or <code class="docutils literal"><span class="pre">DYLD_LIBRARY_PATH</span></code> (on Mac OS X) can interfere with this because the dynamic linker short-circuits link resolution by first looking at <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code>.</p>
<p>For example, let&#8217;s assume that you decided to install an old version of <code class="docutils literal"><span class="pre">libcurl</span></code> into your conda environment due to some compatibility issues with the code you&#8217;re using.  Then, you set <code class="docutils literal"><span class="pre">export</span> <span class="pre">LD_LIBRARY_PATH=/home/jsmith/envs/curl_env/lib</span></code>.  From now on, every program you execute in that session will favor this libcurl to your system libcurl, since it&#8217;s now effectively at the &#8220;front&#8221; of the dynamic load path.</p>
<p>Therefore, we discourage the inclusion of conda environment paths in <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code> or <code class="docutils literal"><span class="pre">DYLD_LIBRARY_PATH</span></code>.</p>
</div>
<div class="section" id="shared-libraries-in-windows">
<h2>Shared libraries in Windows<a class="headerlink" href="#shared-libraries-in-windows" title="Permalink to this headline">¶</a></h2>
<p>Windows does not have the same concept of embedding links into binaries. Instead, Windows depends primarily on searching directories for matching filenames, as documented at <a class="reference external" href="https://msdn.microsoft.com/en-us/library/7d83bc18.aspx">https://msdn.microsoft.com/en-us/library/7d83bc18.aspx</a>.</p>
<p>There is an alternate configuration, called <a class="reference external" href="https://en.wikipedia.org/wiki/Side-by-side_assembly">side-by-side assemblies</a>, that requires specification of DLL versions in either an embedded manifest, or an appropriately named xml file alongside the binary in question. Conda does not currently use side-by-side assemblies, but may turn towards that in the future to resolve complications with multiple versions of the same library on one system.</p>
<p>For now, most DLLs are installed into (install prefix)\Library\bin. As of 2015 November 9, this path is added to os.environ[&#8220;PATH&#8221;] for all Python processes, so that DLLs can be located, regardless of the value of the system&#8217;s PATH environment variable.</p>
<p>Note that PATH is searched from left to right, with the first DLL name match being picked up (in the absence of a manifest specifying otherwise). This means that installing software with other matching DLLs may give you a system that crashes in unpredictable ways. When troubleshooting or asking for support on Windows, always consider PATH as a potential source of issues.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../custom-channels.html" class="btn btn-neutral float-right" title="Custom channels" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../spec.html" class="btn btn-neutral" title="Conda package specification" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Continuum Analytics.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:' ',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27761864-11', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>